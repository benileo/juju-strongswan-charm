#!/usr/bin/env python3

from charmhelpers.core import hookenv
from os.path import exists
from strongswan.openssl import create_root_cert
from strongswan.actions import action_get, action_fail
from strongswan.constants import (
	IPSEC_D_CACERTS,
	CA_CERT
)



if __name__ == '__main__':

	# get the actions parameters
	params = action_get()

	if params :
		if params.get("overwrite") or not exists(IPSEC_D_CACERTS + CA_CERT) :
			create_root_cert( 
				params.get("subject"),
				params.get("lifetime"),
				params.get("keysize")
			)
		else:
			action_fail("Root Cerficate Authority already exists. Pass overwrite=true to overwrite.")
	else:
		action_fail("No parameters were passed to this action.")
