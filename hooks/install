#!/usr/bin/env python3


from strongswan.apt import (
	ss_apt_pkgs,
	run_apt_command
)
from strongswan.sysctl import(
	cp_sysctl_file
)
from strongswan.iptables import(
	iptables
)
from strongswan.hosts import(
	cp_hosts_file,
	flush_hosts_file
)
from charmhelpers.core import (
	hookenv
)

# global config 
config = hookenv.config()

def pre_install():
	iptables() # configure firewall
	cp_sysctl_file()
	cp_hosts_file()
	
		
def install():
	run_apt_command( ["apt-get" , "update", "-qq"] , 30 )
	cmd = ["apt-get" , "install", "-y", "-qq"]
	cmd.extend( ss_apt_pkgs(config) ) 
	run_apt_command( cmd, 60 )
	flush_hosts_file()


if __name__ == "__main__":
	hookenv.log("INFO:\tRunning the install hook")
	pre_install()
	install()
	hookenv.log("INFO:\tInstall hook has completed.")