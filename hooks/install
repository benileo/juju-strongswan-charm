#!/usr/bin/env python


from strongswan.apt import (
	ss_apt_pkgs
)
from strongswan.sysctl import(
	sysctl,
	cp_sysctl
)
from charmhelpers.core import (
	hookenv
)
from charmhelpers.fetch import (
	apt_update,
	apt_install
)

class Strongswan():
	def __init__(self):
		self.config = hookenv.config()

	def pre_install(self):
		cp_sysctl() # make original copy of sysctl file
		sysctl(self.config) # load settings to system

	def install(self):
		hookenv.log("Calling apt to install strongswan packages based on config.yaml")
		apt_update(fatal=False) ## TODO ## keep updating until you get something. 
		pkgs = ss_apt_pkgs(self.config) # get names of strongswan packages to install	
		apt_install(packages=pkgs,fatal=True) # install the packages 
		hookenv.log("Installation of Strongswan packages complete")

	def post_install(self):
		pass


if __name__ == "__main__":

	exit(1)
    strongswan = Strongswan()
    strongswan.pre_install()
    strongswan.install()
    strongswan.post_install()
