#!/usr/bin/env python

# Anything with 'ss' is custom code for StrongSwan Deployment
# Functions should have _ for readability
# Use from <package> import <functions> () 

from strongswan.apt import (
	ss_apt_pkgs
)
from strongswan.sysctl import(
	sysctl
)
from charmhelpers.core import (
	hookenv
)
from charmhelpers.fetch import (
	apt_update,
	apt_install
)

class Strongswan():
	def __init__(self):
		self.config = hookenv.config()

	def pre_install(self):
		sysctl(self.config) # set up sysctl
		
	def install(self):
		hookenv.log("Calling apt to install strongswan packages based on config.yaml")
		apt_update(fatal=False) ## TODO ## keep updating until you get something. 
		pkgs = ss_apt_pkgs(self.config) # get names of strongswan packages to install	
		apt_install(packages=pkgs,fatal=True) # install the packages 
		hookenv.log("Installation of Strongswan packages complete")

	def post_install(self):
		pass


if __name__ == "__main__":
    strongswan = Strongswan()
    strongswan.pre_install()
    strongswan.install()
    strongswan.post_install()
